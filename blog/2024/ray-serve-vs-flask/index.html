<!DOCTYPE html> <html lang="en"> <head> <meta name="google-site-verification" content=""/> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Serve a ML model on a single machine with Flask + Gunicorn vs. FastAPI + Uvicorn | Viet-Phi Huynh</title> <meta name="author" content="Viet-Phi Huynh"/> <meta name="description" content="Viet-Phi Huynh personal webpage. "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://huynhvp.github.io/blog/2024/ray-serve-vs-flask/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Viet-Phi </span>Huynh</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Serve a ML model on a single machine with Flask + Gunicorn vs. FastAPI + Uvicorn</h1> <p class="post-meta">February 1, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/dev"> <i class="fas fa-hashtag fa-sm"></i> dev</a>     ·   <a href="/blog/category/flask"> <i class="fas fa-tag fa-sm"></i> flask,</a>   <a href="/blog/category/gunicorn"> <i class="fas fa-tag fa-sm"></i> gunicorn,</a>   <a href="/blog/category/fastapi"> <i class="fas fa-tag fa-sm"></i> fastapi,</a>   <a href="/blog/category/uvicorn"> <i class="fas fa-tag fa-sm"></i> uvicorn</a>   </p> </header> <article class="post-content"> <p><a href="https://docs.gunicorn.org/en/stable/design.html" target="_blank" rel="noopener noreferrer">Gunicorn</a> is a Python Web Server Gateway Interface (WSGI) HTTP server based on the pre-fork worker model. By default, Gunicorn workers are synchronous, which handle a single request at a time. However, Gunicorn also supports asynchronous workers, such as <code class="language-plaintext highlighter-rouge">gevent</code> or <code class="language-plaintext highlighter-rouge">eventlet</code>, which can manage multiple simutaneous requests. The web application framework, <a href="https://github.com/pallets/flask" target="_blank" rel="noopener noreferrer">Flask</a>, typically paired with Gunicorn, forms a synchronous or asynchronous web service depending on whether sync or async gunicorn workers are used.</p> <p><a href="https://www.uvicorn.org/" target="_blank" rel="noopener noreferrer">Uvicorn</a>, unlike Gunicorn, is inherently a Python Asynchronous Server Gateway Interface (ASGI) HTTP server. The web application framework, <a href="https://github.com/tiangolo/fastapi" target="_blank" rel="noopener noreferrer">FastAPI</a> uses Uvicorn internally to serve an asynchronous web service.</p> <p>Let’s minimally deploy a standalone ML model on a single machine with Flask + Gunicorn and FastAPI + Uvicorn and measure the throughput (i.e. time to process 1000 concurrent requests) of both systems.</p> <hr> <p><b>Table of Contents</b></p> <ul id="markdown-toc"> <li><a href="#1-cpu-bound-deploy-a-named-entity-recognition-ner-model" id="markdown-toc-1-cpu-bound-deploy-a-named-entity-recognition-ner-model">1. CPU-bound: Deploy a Named Entity Recognition (NER) model</a></li> <li><a href="#2-cpu--and-io--bound-deploy-a-named-entity-recognition-ner-model-preceded-by-io-operations" id="markdown-toc-2-cpu--and-io--bound-deploy-a-named-entity-recognition-ner-model-preceded-by-io-operations">2. CPU- and IO- bound: Deploy a Named Entity Recognition (NER) model, preceded by IO operations.</a></li> </ul> <h4 id="1-cpu-bound-deploy-a-named-entity-recognition-ner-model">1. CPU-bound: Deploy a Named Entity Recognition (NER) model</h4> <p><b>Server</b></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># server.py
</span><span class="kn">import</span> <span class="n">fastapi</span>
<span class="kn">import</span> <span class="n">flask</span>
<span class="kn">import</span> <span class="n">spacy</span>

<span class="c1"># load NER model
</span><span class="n">ner</span> <span class="o">=</span> <span class="n">spacy</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">en_core_web_sm</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># flask web server
</span><span class="n">flask_app</span> <span class="o">=</span> <span class="n">flask</span><span class="p">.</span><span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@flask_app.get</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">ner_flask</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">flask</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="nf">ner</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ent</span><span class="p">.</span><span class="n">text</span><span class="p">:</span> <span class="n">ent</span><span class="p">.</span><span class="n">label_</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">.</span><span class="n">ents</span><span class="p">}</span>

<span class="c1"># fastapi web server
</span><span class="n">fastapi_app</span> <span class="o">=</span> <span class="n">fastapi</span><span class="p">.</span><span class="nc">FastAPI</span><span class="p">()</span>

<span class="nd">@fastapi_app.get</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">ner_fastapi</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">fastapi</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="n">request</span><span class="p">.</span><span class="nf">json</span><span class="p">()).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="nf">ner</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ent</span><span class="p">.</span><span class="n">text</span><span class="p">:</span> <span class="n">ent</span><span class="p">.</span><span class="n">label_</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">.</span><span class="n">ents</span><span class="p">}</span>

</code></pre></div></div> <ul> <li>Run the synchronus API with Flask and Gunicorn’s sync workers. <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>gunicorn <span class="nt">--bind</span> 127.0.0.1:5000 <span class="nt">--worker-connections</span> 1000  <span class="nt">-w</span> 2  server:flask_app
</code></pre></div> </div> </li> <li>Run the asynchronus API with Flask and Gunicorn’s async workers <code class="language-plaintext highlighter-rouge">gevent</code>. <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>gunicorn <span class="nt">--bind</span> 127.0.0.1:5000 <span class="nt">--worker-class</span><span class="o">=</span>gevent <span class="nt">--worker-connections</span> 1000  <span class="nt">-w</span> 2  server:flask_app
</code></pre></div> </div> </li> <li>Run the asynchronus API with FastAPI and Uvicorn <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>uvicorn <span class="nt">--host</span> 127.0.0.1 <span class="nt">--port</span> 5000 <span class="nt">--limit-concurrency</span> 1000 <span class="nt">--workers</span> 2  server:fastapi_app 
</code></pre></div> </div> </li> </ul> <p>where:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">-w</code> or <code class="language-plaintext highlighter-rouge">--workers</code>: number of workers for handling requests.</li> <li> <code class="language-plaintext highlighter-rouge">--worker-connections</code> or <code class="language-plaintext highlighter-rouge">--limit-concurrency</code>: maximum number of concurrent requests a worker can handle.</li> </ul> <p><b>Client</b>: let’s make 1000 simultaneous requests, send them to the server, and measure the processing time.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># client.py
</span><span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="kn">from</span> <span class="n">aiohttp</span> <span class="kn">import</span> <span class="n">ClientSession</span>

<span class="n">api_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://127.0.0.1:5000/</span><span class="sh">"</span>

<span class="n">text</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">Paris[a] is the capital and most populous city of France. With an official estimated population of 2,102,650 residents
as of 1 January 2023[2] in an area of more than 105 km2 (41 sq mi),[5] Paris is the fourth-most populated city in the European
Union and the 30th most densely populated city in the world in 2022.[6] Since the 17th century, Paris has been one of the world</span><span class="sh">'</span><span class="s">
major centres of finance, diplomacy, commerce, culture, fashion, and gastronomy. For its leading role in the arts and sciences,
as well as its early and extensive system of street lighting, in the 19th century, it became known as the City of Light.[7]
The City of Paris is the centre of the Île-de-France region, or Paris Region, with an officia estimated population of 12,271,794
inhabitants on 1 January 2023, or about 19% of the population of France.
</span><span class="sh">"""</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">ClientSession</span><span class="p">,</span> <span class="n">i_request</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="c1"># fetch NER result for a request
</span>    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">i_request</span><span class="sh">"</span><span class="p">:</span> <span class="n">i_request</span><span class="p">,</span> <span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">:</span> <span class="n">text</span><span class="p">})</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">i_trial</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="c1"># send 1000 simultaneous requests to the server
</span>    <span class="n">num_requests</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="k">async</span> <span class="k">with</span> <span class="nc">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i_request</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_requests</span><span class="p">):</span>
            <span class="n">tasks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">fetch</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">i_trial</span><span class="o">*</span><span class="n">num_requests</span> <span class="o">+</span> <span class="n">i_request</span><span class="p">))</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

<span class="n">num_trials</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i_trial</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">(</span><span class="n">i_trial</span><span class="p">))</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">perf_counter</span><span class="p">()</span>
    <span class="n">times</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Avg Time: </span><span class="si">{</span><span class="nf">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">/</span><span class="nf">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

</code></pre></div></div> <p><strong><span style="color:green"><b>Processing time for a batch of 1000 simultanous requests</b></span></strong></p> <table> <thead> <tr> <th>Number of workers</th> <th>w=1</th> <th>w=2</th> <th>w=4</th> </tr> <tr> <th>API</th> <th> </th> <th> </th> <th> </th> </tr> </thead> <tbody> <tr> <td>Flask + sync Gunicorn</td> <td>5.63 (s)</td> <td>3.34 (s)</td> <td>2.31 (s)</td> </tr> <tr> <td>Flask + async Gunicorn</td> <td>6.04 (s)</td> <td>3.29 (s)</td> <td>2.33 (s)</td> </tr> <tr> <td>FastAPI + async Uvicorn</td> <td>6.35 (s)</td> <td>3.5 (s)</td> <td>2.62 (s)</td> </tr> </tbody> </table> <p></p> <p>As the model spends all its time on the CPU to process requests, designing an async web application is not helpful.</p> <h4 id="2-cpu--and-io--bound-deploy-a-named-entity-recognition-ner-model-preceded-by-io-operations">2. CPU- and IO- bound: Deploy a Named Entity Recognition (NER) model, preceded by IO operations.</h4> <p>Just for testing purposes, let’s add a nonsensical <code class="language-plaintext highlighter-rouge">sleep(0.1)</code> to the model, to represent its IO-bound aspect, and mesure again the throughputs.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># server.py
</span><span class="nd">@flask_app.get</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">ner_flask</span><span class="p">():</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># do some IO operations
</span>    <span class="n">text</span> <span class="o">=</span> <span class="n">flask</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="nf">ner</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ent</span><span class="p">.</span><span class="n">text</span><span class="p">:</span> <span class="n">ent</span><span class="p">.</span><span class="n">label_</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">.</span><span class="n">ents</span><span class="p">}</span>

<span class="nd">@fastapi_app.get</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">ner_fastapi</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">fastapi</span><span class="p">.</span><span class="n">Request</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># do some IO operations
</span>    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="n">request</span><span class="p">.</span><span class="nf">json</span><span class="p">()).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="nf">ner</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ent</span><span class="p">.</span><span class="n">text</span><span class="p">:</span> <span class="n">ent</span><span class="p">.</span><span class="n">label_</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">.</span><span class="n">ents</span><span class="p">}</span>
</code></pre></div></div> <p><strong><span style="color:green"><b>Processing time for a batch of 1000 simultanous requests</b></span></strong></p> <table> <thead> <tr> <th>Priority apples</th> <th>1</th> <th>2</th> <th>4</th> </tr> </thead> <tbody> <tr> <td>Flask + sync Gunicorn</td> <td>129.69 (s)</td> <td>65.51 (s)</td> <td>33.25 (s)</td> </tr> <tr> <td>Flask + async Gunicorn</td> <td>7.62 (s)</td> <td>3.73 (s)</td> <td>3.19 (s)</td> </tr> <tr> <td>FastAPI + async Uvicorn</td> <td>7.80 (s)</td> <td>4.14 (s)</td> <td>2.74 (s)</td> </tr> </tbody> </table> <p></p> <p>Clearly, the async implementation significantly improve the efficiency of model serving.</p> <p>Additionally, in both test cases, it appears that the difference between Flask with async Gunicorn workers and FastAPI is not conclusive.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Viet-Phi Huynh. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>